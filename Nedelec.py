from numpy import array
from numpy import shape as size
from numpy import zeros
from numpy import column_stack
class Nedelec:
	X = array([[6.734224221009821e-02, 3.108859192633006e-01, 3.108859192633006e-01],
	       [3.108859192633006e-01, 6.734224221009821e-02, 3.108859192633006e-01],
	       [3.108859192633006e-01, 3.108859192633006e-01, 6.734224221009821e-02],
	       [3.108859192633006e-01, 3.108859192633006e-01, 3.108859192633006e-01],
	       [9.273525031089122e-02, 9.273525031089122e-02, 9.273525031089122e-02],
	       [9.273525031089122e-02, 9.273525031089122e-02, 7.217942490673264e-01],
	       [9.273525031089122e-02, 7.217942490673264e-01, 9.273525031089122e-02],
	       [7.217942490673264e-01, 9.273525031089122e-02, 9.273525031089122e-02],
	       [4.550370412564965e-02, 4.550370412564965e-02, 4.544962958743504e-01],
	       [4.550370412564965e-02, 4.544962958743504e-01, 4.550370412564965e-02],
	       [4.550370412564965e-02, 4.544962958743504e-01, 4.544962958743504e-01],
	       [4.544962958743504e-01, 4.550370412564965e-02, 4.550370412564965e-02],
	       [4.544962958743504e-01, 4.550370412564965e-02, 4.544962958743504e-01],
	       [4.544962958743504e-01, 4.544962958743504e-01, 4.550370412564965e-02]])
	W = array([[1.878132095300264e-02],
	       [1.878132095300264e-02],
	       [1.878132095300264e-02],
	       [1.878132095300264e-02],
	       [1.224884051939366e-02],
	       [1.224884051939366e-02],
	       [1.224884051939366e-02],
	       [1.224884051939366e-02],
	       [7.091003462846910e-03],
	       [7.091003462846910e-03],
	       [7.091003462846910e-03],
	       [7.091003462846910e-03],
	       [7.091003462846910e-03],
	       [7.091003462846910e-03]])
	@staticmethod
	def getW(order, X = None, orientation	= 1):
		if order == 1 and X is None:
			X =Nedelec.X
			W = Nedelec.W
			Nq = size(X)[0];
			Wij = zeros((Nq,3,6))
			CWij = zeros((Nq,3,6))
			Z = zeros(Nq)
			O = Z+1;
			Ndof = 6
			if orientation == 1:				
				Wij[:,:,0]=column_stack((1 - X[:,2] - X[:,1],X[:,0],X[:,0]));
				CWij[:,:,0]=column_stack((Z,-2*O,2*O));
				Wij[:,:,1]=column_stack((X[:,1],1 - X[:,2] - X[:,0],X[:,1]));
				CWij[:,:,1]=column_stack((2*O,Z,-2*O));
				Wij[:,:,2]=column_stack((X[:,2],X[:,2],1 - X[:,1] - X[:,0]));
				CWij[:,:,2]=column_stack((-2*O,2*O,Z));
				Wij[:,:,3]=column_stack((-X[:,1],X[:,0],Z));
				CWij[:,:,3]=column_stack((Z,Z,2*O));
				Wij[:,:,4]=column_stack((Z,-X[:,2],X[:,1]));
				CWij[:,:,4]=column_stack((2*O,Z,Z));
				Wij[:,:,5]=column_stack((-X[:,2],Z,X[:,0]));
				CWij[:,:,5]=column_stack((Z,-2*O,Z));
			elif orientation	== -1:
				Wij[:,:,0]=column_stack((1 - X[:,2] - X[:,1],X[:,0],X[:,0]));
				CWij[:,:,0]=column_stack((Z,-2*O,2*O));
				Wij[:,:,1]=column_stack((X[:,1],1 - X[:,2] - X[:,0],X[:,1]));
				CWij[:,:,1]=column_stack((2*O,Z,-2*O));
				Wij[:,:,2]=column_stack((X[:,2],X[:,2],1 - X[:,1] - X[:,0]));
				CWij[:,:,2]=column_stack((-2*O,2*O,Z));
				Wij[:,:,3]=column_stack((X[:,1],-X[:,0],Z));
				CWij[:,:,3]=column_stack((Z,Z,-2*O));
				Wij[:,:,4]=column_stack((Z,-X[:,2],X[:,1]));
				CWij[:,:,4]=column_stack((2*O,Z,Z));
				Wij[:,:,5]=column_stack((-X[:,2],Z,X[:,0]));
				CWij[:,:,5]=column_stack((Z,-2*O,Z));
		

			return (Wij,CWij,W,Nq,Ndof)
		elif order == 1 and  X is not None:
			Nq = size(X)[0];
			Wij = zeros((Nq,3,6))
			CWij = zeros((Nq,3,6))
			Z = zeros(Nq)
			O = Z+1;
			if orientation ==1:
				Wij[:,:,0]=column_stack((1 - X[:,2] - X[:,1],X[:,0],X[:,0]));
				CWij[:,:,0]=column_stack((Z,-2*O,2*O));
				Wij[:,:,1]=column_stack((X[:,1],1 - X[:,2] - X[:,0],X[:,1]));
				CWij[:,:,1]=column_stack((2*O,Z,-2*O));
				Wij[:,:,2]=column_stack((X[:,2],X[:,2],1 - X[:,1] - X[:,0]));
				CWij[:,:,2]=column_stack((-2*O,2*O,Z));
				Wij[:,:,3]=column_stack((-X[:,1],X[:,0],Z));
				CWij[:,:,3]=column_stack((Z,Z,2*O));
				Wij[:,:,4]=column_stack((Z,-X[:,2],X[:,1]));
				CWij[:,:,4]=column_stack((2*O,Z,Z));
				Wij[:,:,5]=column_stack((-X[:,2],Z,X[:,0]));
				CWij[:,:,5]=column_stack((Z,-2*O,Z));
			elif orientation	== -1:
				Wij[:,:,0]=column_stack((1 - X[:,2] - X[:,1],X[:,0],X[:,0]));
				CWij[:,:,0]=column_stack((Z,-2*O,2*O));
				Wij[:,:,1]=column_stack((X[:,1],1 - X[:,2] - X[:,0],X[:,1]));
				CWij[:,:,1]=column_stack((2*O,Z,-2*O));
				Wij[:,:,2]=column_stack((X[:,2],X[:,2],1 - X[:,1] - X[:,0]));
				CWij[:,:,2]=column_stack((-2*O,2*O,Z));
				Wij[:,:,3]=column_stack((X[:,1],-X[:,0],Z));
				CWij[:,:,3]=column_stack((Z,Z,-2*O));
				Wij[:,:,4]=column_stack((Z,-X[:,2],X[:,1]));
				CWij[:,:,4]=column_stack((2*O,Z,Z));
				Wij[:,:,5]=column_stack((-X[:,2],Z,X[:,0]));
				CWij[:,:,5]=column_stack((Z,-2*O,Z));


		
			return (Wij,CWij,Nq)
		elif order == 2 and X is None:
			X =Nedelec.X
			W = Nedelec.W
			Nq = size(X)[0];
			Wij = zeros((Nq,3,20))
			CWij = zeros((Nq,3,20))
			Z = zeros(Nq)
			O = Z+1;
			Ndof = 20
			if orientation ==1:
				Wij[:,:,0]=column_stack((8*X[:,0]*X[:,1] - 12*X[:,1] - 12*X[:,2] - 6*X[:,0] + 8*X[:,0]*X[:,2] + 16*X[:,1]*X[:,2] + 8*X[:,1]**2 + 8*X[:,2]**2 + 4,-2*X[:,0]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),-2*X[:,0]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3)))
				CWij[:,:,0]=column_stack((Z,24*X[:,0] + 24*X[:,1] + 24*X[:,2] - 18,18 - 24*X[:,1] - 24*X[:,2] - 24*X[:,0]))
				Wij[:,:,1]=column_stack((6*X[:,0] + 2*X[:,1] + 2*X[:,2] - 8*X[:,0]*X[:,1] - 8*X[:,0]*X[:,2] - 2,4*X[:,0]*(2*X[:,0] - 1),4*X[:,0]*(2*X[:,0] - 1)))
				CWij[:,:,1]=column_stack((Z,6 - 24*X[:,0],24*X[:,0] - 6))
				Wij[:,:,2]=column_stack((-2*X[:,1]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),8*X[:,0]*X[:,1] - 6*X[:,1] - 12*X[:,2] - 12*X[:,0] + 16*X[:,0]*X[:,2] + 8*X[:,1]*X[:,2] + 8*X[:,0]**2 + 8*X[:,2]**2 + 4,-2*X[:,1]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3)))
				CWij[:,:,2]=column_stack((18 - 24*X[:,1] - 24*X[:,2] - 24*X[:,0],Z,24*X[:,0] + 24*X[:,1] + 24*X[:,2] - 18))
				Wij[:,:,3]=column_stack((4*X[:,1]*(2*X[:,1] - 1),2*X[:,0] + 6*X[:,1] + 2*X[:,2] - 8*X[:,0]*X[:,1] - 8*X[:,1]*X[:,2] - 2,4*X[:,1]*(2*X[:,1] - 1)))
				CWij[:,:,3]=column_stack((24*X[:,1] - 6,Z,6 - 24*X[:,1]))
				Wij[:,:,4]=column_stack((-2*X[:,2]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),-2*X[:,2]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),16*X[:,0]*X[:,1] - 12*X[:,1] - 6*X[:,2] - 12*X[:,0] + 8*X[:,0]*X[:,2] + 8*X[:,1]*X[:,2] + 8*X[:,0]**2 + 8*X[:,1]**2 + 4))
				CWij[:,:,4]=column_stack((24*X[:,0] + 24*X[:,1] + 24*X[:,2] - 18,18 - 24*X[:,1] - 24*X[:,2] - 24*X[:,0],Z))
				Wij[:,:,5]=column_stack((4*X[:,2]*(2*X[:,2] - 1),4*X[:,2]*(2*X[:,2] - 1),2*X[:,0] + 2*X[:,1] + 6*X[:,2] - 8*X[:,0]*X[:,2] - 8*X[:,1]*X[:,2] - 2))
				CWij[:,:,5]=column_stack((6 - 24*X[:,2],24*X[:,2] - 6,Z))
				Wij[:,:,6]=column_stack((-2*X[:,1]*(4*X[:,0] - 1),4*X[:,0]*(2*X[:,0] - 1),Z))
				CWij[:,:,6]=column_stack((Z,Z,24*X[:,0] - 6))
				Wij[:,:,7]=column_stack((-4*X[:,1]*(2*X[:,1] - 1),2*X[:,0]*(4*X[:,1] - 1),Z))
				CWij[:,:,7]=column_stack((Z,Z,24*X[:,1] - 6))
				Wij[:,:,8]=column_stack((Z,-2*X[:,2]*(4*X[:,1] - 1),4*X[:,1]*(2*X[:,1] - 1)))
				CWij[:,:,8]=column_stack((24*X[:,1] - 6,Z,Z))
				Wij[:,:,9]=column_stack((Z,-4*X[:,2]*(2*X[:,2] - 1),2*X[:,1]*(4*X[:,2] - 1)))
				CWij[:,:,9]=column_stack((24*X[:,2] - 6,Z,Z))
				Wij[:,:,10]=column_stack((-4*X[:,2]*(2*X[:,2] - 1),Z,2*X[:,0]*(4*X[:,2] - 1)))
				CWij[:,:,10]=column_stack((Z,6 - 24*X[:,2],Z))
				Wij[:,:,11]=column_stack((-2*X[:,2]*(4*X[:,0] - 1),Z,4*X[:,0]*(2*X[:,0] - 1)))
				CWij[:,:,11]=column_stack((Z,6 - 24*X[:,0],Z))
				Wij[:,:,12]=column_stack((-4*X[:,1]*X[:,2],8*X[:,0]*X[:,2],-4*X[:,0]*X[:,1]))
				CWij[:,:,12]=column_stack((-12*X[:,0],Z,12*X[:,2]))
				Wij[:,:,13]=column_stack((4*X[:,1]*X[:,2],-4*X[:,2]*(2*X[:,0] + X[:,1] + 2*X[:,2] - 2),4*X[:,1]*(X[:,0] + X[:,1] + 2*X[:,2] - 1)))
				CWij[:,:,13]=column_stack((12*X[:,0] + 12*X[:,1] + 24*X[:,2] - 12,Z,-12*X[:,2]))
				Wij[:,:,14]=column_stack((-4*X[:,2]*(X[:,0] + 2*X[:,1] + 2*X[:,2] - 2),4*X[:,0]*X[:,2],4*X[:,0]*(X[:,0] + X[:,1] + 2*X[:,2] - 1)))
				CWij[:,:,14]=column_stack((Z,12 - 12*X[:,1] - 24*X[:,2] - 12*X[:,0],12*X[:,2]))
				Wij[:,:,15]=column_stack((-4*X[:,1]*(X[:,0] + 2*X[:,1] + 2*X[:,2] - 2),4*X[:,0]*(X[:,0] + 2*X[:,1] + X[:,2] - 1),4*X[:,0]*X[:,1]))
				CWij[:,:,15]=column_stack((Z,-12*X[:,1],12*X[:,0] + 24*X[:,1] + 12*X[:,2] - 12))
				Wij[:,:,16]=column_stack((-4*X[:,1]*X[:,2],-4*X[:,0]*X[:,2],8*X[:,0]*X[:,1]))
				CWij[:,:,16]=column_stack((12*X[:,0],-12*X[:,1],Z))
				Wij[:,:,17]=column_stack((4*X[:,1]*X[:,2],4*X[:,2]*(X[:,0] + 2*X[:,1] + X[:,2] - 1),-4*X[:,1]*(2*X[:,0] + 2*X[:,1] + X[:,2] - 2)))
				CWij[:,:,17]=column_stack((12 - 24*X[:,1] - 12*X[:,2] - 12*X[:,0],12*X[:,1],Z))
				Wij[:,:,18]=column_stack((4*X[:,2]*(2*X[:,0] + X[:,1] + X[:,2] - 1),4*X[:,0]*X[:,2],-4*X[:,0]*(2*X[:,0] + 2*X[:,1] + X[:,2] - 2)))
				CWij[:,:,18]=column_stack((-12*X[:,0],24*X[:,0] + 12*X[:,1] + 12*X[:,2] - 12,Z))
				Wij[:,:,19]=column_stack((4*X[:,1]*(2*X[:,0] + X[:,1] + X[:,2] - 1),-4*X[:,0]*(2*X[:,0] + X[:,1] + 2*X[:,2] - 2),4*X[:,0]*X[:,1]))
				CWij[:,:,19]=column_stack((12*X[:,0],Z,12 - 12*X[:,1] - 12*X[:,2] - 24*X[:,0]))


			elif orientation == -1:
				
				Wij[:,:,0]=column_stack((8*X[:,0]*X[:,1] - 12*X[:,1] - 12*X[:,2] - 6*X[:,0] + 8*X[:,0]*X[:,2] + 16*X[:,1]*X[:,2] + 8*X[:,1]**2 + 8*X[:,2]**2 + 4,-2*X[:,0]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),-2*X[:,0]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3)))
				CWij[:,:,0]=column_stack((Z,24*X[:,0] + 24*X[:,1] + 24*X[:,2] - 18,18 - 24*X[:,1] - 24*X[:,2] - 24*X[:,0]))
				Wij[:,:,1]=column_stack((6*X[:,0] + 2*X[:,1] + 2*X[:,2] - 8*X[:,0]*X[:,1] - 8*X[:,0]*X[:,2] - 2,4*X[:,0]*(2*X[:,0] - 1),4*X[:,0]*(2*X[:,0] - 1)))
				CWij[:,:,1]=column_stack((Z,6 - 24*X[:,0],24*X[:,0] - 6))
				Wij[:,:,2]=column_stack((-2*X[:,1]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),8*X[:,0]*X[:,1] - 6*X[:,1] - 12*X[:,2] - 12*X[:,0] + 16*X[:,0]*X[:,2] + 8*X[:,1]*X[:,2] + 8*X[:,0]**2 + 8*X[:,2]**2 + 4,-2*X[:,1]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3)))
				CWij[:,:,2]=column_stack((18 - 24*X[:,1] - 24*X[:,2] - 24*X[:,0],Z,24*X[:,0] + 24*X[:,1] + 24*X[:,2] - 18))
				Wij[:,:,3]=column_stack((4*X[:,1]*(2*X[:,1] - 1),2*X[:,0] + 6*X[:,1] + 2*X[:,2] - 8*X[:,0]*X[:,1] - 8*X[:,1]*X[:,2] - 2,4*X[:,1]*(2*X[:,1] - 1)))
				CWij[:,:,3]=column_stack((24*X[:,1] - 6,Z,6 - 24*X[:,1]))
				Wij[:,:,4]=column_stack((-2*X[:,2]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),-2*X[:,2]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),16*X[:,0]*X[:,1] - 12*X[:,1] - 6*X[:,2] - 12*X[:,0] + 8*X[:,0]*X[:,2] + 8*X[:,1]*X[:,2] + 8*X[:,0]**2 + 8*X[:,1]**2 + 4))
				CWij[:,:,4]=column_stack((24*X[:,0] + 24*X[:,1] + 24*X[:,2] - 18,18 - 24*X[:,1] - 24*X[:,2] - 24*X[:,0],Z))
				Wij[:,:,5]=column_stack((4*X[:,2]*(2*X[:,2] - 1),4*X[:,2]*(2*X[:,2] - 1),2*X[:,0] + 2*X[:,1] + 6*X[:,2] - 8*X[:,0]*X[:,2] - 8*X[:,1]*X[:,2] - 2))
				CWij[:,:,5]=column_stack((6 - 24*X[:,2],24*X[:,2] - 6,Z))
				Wij[:,:,6]=column_stack((2*X[:,1]*(4*X[:,0] - 1),-4*X[:,0]*(2*X[:,0] - 1),Z))
				CWij[:,:,6]=column_stack((Z,Z,6 - 24*X[:,0]))
				Wij[:,:,7]=column_stack((4*X[:,1]*(2*X[:,1] - 1),-2*X[:,0]*(4*X[:,1] - 1),Z))
				CWij[:,:,7]=column_stack((Z,Z,6 - 24*X[:,1]))
				Wij[:,:,8]=column_stack((Z,-2*X[:,2]*(4*X[:,1] - 1),4*X[:,1]*(2*X[:,1] - 1)))
				CWij[:,:,8]=column_stack((24*X[:,1] - 6,Z,Z))
				Wij[:,:,9]=column_stack((Z,-4*X[:,2]*(2*X[:,2] - 1),2*X[:,1]*(4*X[:,2] - 1)))
				CWij[:,:,9]=column_stack((24*X[:,2] - 6,Z,Z))
				Wij[:,:,10]=column_stack((-4*X[:,2]*(2*X[:,2] - 1),Z,2*X[:,0]*(4*X[:,2] - 1)))
				CWij[:,:,10]=column_stack((Z,6 - 24*X[:,2],Z))
				Wij[:,:,11]=column_stack((-2*X[:,2]*(4*X[:,0] - 1),Z,4*X[:,0]*(2*X[:,0] - 1)))
				CWij[:,:,11]=column_stack((Z,6 - 24*X[:,0],Z))
				Wij[:,:,12]=column_stack((8*X[:,1]*X[:,2],-4*X[:,0]*X[:,2],-4*X[:,0]*X[:,1]))
				CWij[:,:,12]=column_stack((Z,12*X[:,1],-12*X[:,2]))
				Wij[:,:,13]=column_stack((4*X[:,1]*X[:,2],-4*X[:,2]*(2*X[:,0] + X[:,1] + 2*X[:,2] - 2),4*X[:,1]*(X[:,0] + X[:,1] + 2*X[:,2] - 1)))
				CWij[:,:,13]=column_stack((12*X[:,0] + 12*X[:,1] + 24*X[:,2] - 12,Z,-12*X[:,2]))
				Wij[:,:,14]=column_stack((-4*X[:,2]*(X[:,0] + 2*X[:,1] + 2*X[:,2] - 2),4*X[:,0]*X[:,2],4*X[:,0]*(X[:,0] + X[:,1] + 2*X[:,2] - 1)))
				CWij[:,:,14]=column_stack((Z,12 - 12*X[:,1] - 24*X[:,2] - 12*X[:,0],12*X[:,2]))
				Wij[:,:,15]=column_stack((4*X[:,1]*(2*X[:,0] + X[:,1] + X[:,2] - 1),-4*X[:,0]*(2*X[:,0] + X[:,1] + 2*X[:,2] - 2),4*X[:,0]*X[:,1]))
				CWij[:,:,15]=column_stack((12*X[:,0],Z,12 - 12*X[:,1] - 12*X[:,2] - 24*X[:,0]))
				Wij[:,:,16]=column_stack((-4*X[:,1]*X[:,2],-4*X[:,0]*X[:,2],8*X[:,0]*X[:,1]))
				CWij[:,:,16]=column_stack((12*X[:,0],-12*X[:,1],Z))
				Wij[:,:,17]=column_stack((4*X[:,1]*X[:,2],4*X[:,2]*(X[:,0] + 2*X[:,1] + X[:,2] - 1),-4*X[:,1]*(2*X[:,0] + 2*X[:,1] + X[:,2] - 2)))
				CWij[:,:,17]=column_stack((12 - 24*X[:,1] - 12*X[:,2] - 12*X[:,0],12*X[:,1],Z))
				Wij[:,:,18]=column_stack((4*X[:,2]*(2*X[:,0] + X[:,1] + X[:,2] - 1),4*X[:,0]*X[:,2],-4*X[:,0]*(2*X[:,0] + 2*X[:,1] + X[:,2] - 2)))
				CWij[:,:,18]=column_stack((-12*X[:,0],24*X[:,0] + 12*X[:,1] + 12*X[:,2] - 12,Z))
				Wij[:,:,19]=column_stack((-4*X[:,1]*(X[:,0] + 2*X[:,1] + 2*X[:,2] - 2),4*X[:,0]*(X[:,0] + 2*X[:,1] + X[:,2] - 1),4*X[:,0]*X[:,1]))
				CWij[:,:,19]=column_stack((Z,-12*X[:,1],12*X[:,0] + 24*X[:,1] + 12*X[:,2] - 12))
			return (Wij,CWij,W,Nq,Ndof)

		elif order == 2 and  X is not None:
			Nq = size(X)[0];
			Wij = zeros((Nq,3,20))
			CWij = zeros((Nq,3,20))
			Z = zeros(Nq)
			O = Z+1;
			if orientation == 1:
				Wij[:,:,0]=column_stack((8*X[:,0]*X[:,1] - 12*X[:,1] - 12*X[:,2] - 6*X[:,0] + 8*X[:,0]*X[:,2] + 16*X[:,1]*X[:,2] + 8*X[:,1]**2 + 8*X[:,2]**2 + 4,-2*X[:,0]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),-2*X[:,0]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3)))
				CWij[:,:,0]=column_stack((Z,24*X[:,0] + 24*X[:,1] + 24*X[:,2] - 18,18 - 24*X[:,1] - 24*X[:,2] - 24*X[:,0]))
				Wij[:,:,1]=column_stack((6*X[:,0] + 2*X[:,1] + 2*X[:,2] - 8*X[:,0]*X[:,1] - 8*X[:,0]*X[:,2] - 2,4*X[:,0]*(2*X[:,0] - 1),4*X[:,0]*(2*X[:,0] - 1)))
				CWij[:,:,1]=column_stack((Z,6 - 24*X[:,0],24*X[:,0] - 6))
				Wij[:,:,2]=column_stack((-2*X[:,1]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),8*X[:,0]*X[:,1] - 6*X[:,1] - 12*X[:,2] - 12*X[:,0] + 16*X[:,0]*X[:,2] + 8*X[:,1]*X[:,2] + 8*X[:,0]**2 + 8*X[:,2]**2 + 4,-2*X[:,1]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3)))
				CWij[:,:,2]=column_stack((18 - 24*X[:,1] - 24*X[:,2] - 24*X[:,0],Z,24*X[:,0] + 24*X[:,1] + 24*X[:,2] - 18))
				Wij[:,:,3]=column_stack((4*X[:,1]*(2*X[:,1] - 1),2*X[:,0] + 6*X[:,1] + 2*X[:,2] - 8*X[:,0]*X[:,1] - 8*X[:,1]*X[:,2] - 2,4*X[:,1]*(2*X[:,1] - 1)))
				CWij[:,:,3]=column_stack((24*X[:,1] - 6,Z,6 - 24*X[:,1]))
				Wij[:,:,4]=column_stack((-2*X[:,2]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),-2*X[:,2]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),16*X[:,0]*X[:,1] - 12*X[:,1] - 6*X[:,2] - 12*X[:,0] + 8*X[:,0]*X[:,2] + 8*X[:,1]*X[:,2] + 8*X[:,0]**2 + 8*X[:,1]**2 + 4))
				CWij[:,:,4]=column_stack((24*X[:,0] + 24*X[:,1] + 24*X[:,2] - 18,18 - 24*X[:,1] - 24*X[:,2] - 24*X[:,0],Z))
				Wij[:,:,5]=column_stack((4*X[:,2]*(2*X[:,2] - 1),4*X[:,2]*(2*X[:,2] - 1),2*X[:,0] + 2*X[:,1] + 6*X[:,2] - 8*X[:,0]*X[:,2] - 8*X[:,1]*X[:,2] - 2))
				CWij[:,:,5]=column_stack((6 - 24*X[:,2],24*X[:,2] - 6,Z))
				Wij[:,:,6]=column_stack((-2*X[:,1]*(4*X[:,0] - 1),4*X[:,0]*(2*X[:,0] - 1),Z))
				CWij[:,:,6]=column_stack((Z,Z,24*X[:,0] - 6))
				Wij[:,:,7]=column_stack((-4*X[:,1]*(2*X[:,1] - 1),2*X[:,0]*(4*X[:,1] - 1),Z))
				CWij[:,:,7]=column_stack((Z,Z,24*X[:,1] - 6))
				Wij[:,:,8]=column_stack((Z,-2*X[:,2]*(4*X[:,1] - 1),4*X[:,1]*(2*X[:,1] - 1)))
				CWij[:,:,8]=column_stack((24*X[:,1] - 6,Z,Z))
				Wij[:,:,9]=column_stack((Z,-4*X[:,2]*(2*X[:,2] - 1),2*X[:,1]*(4*X[:,2] - 1)))
				CWij[:,:,9]=column_stack((24*X[:,2] - 6,Z,Z))
				Wij[:,:,10]=column_stack((-4*X[:,2]*(2*X[:,2] - 1),Z,2*X[:,0]*(4*X[:,2] - 1)))
				CWij[:,:,10]=column_stack((Z,6 - 24*X[:,2],Z))
				Wij[:,:,11]=column_stack((-2*X[:,2]*(4*X[:,0] - 1),Z,4*X[:,0]*(2*X[:,0] - 1)))
				CWij[:,:,11]=column_stack((Z,6 - 24*X[:,0],Z))
				Wij[:,:,12]=column_stack((-4*X[:,1]*X[:,2],8*X[:,0]*X[:,2],-4*X[:,0]*X[:,1]))
				CWij[:,:,12]=column_stack((-12*X[:,0],Z,12*X[:,2]))
				Wij[:,:,13]=column_stack((4*X[:,1]*X[:,2],-4*X[:,2]*(2*X[:,0] + X[:,1] + 2*X[:,2] - 2),4*X[:,1]*(X[:,0] + X[:,1] + 2*X[:,2] - 1)))
				CWij[:,:,13]=column_stack((12*X[:,0] + 12*X[:,1] + 24*X[:,2] - 12,Z,-12*X[:,2]))
				Wij[:,:,14]=column_stack((-4*X[:,2]*(X[:,0] + 2*X[:,1] + 2*X[:,2] - 2),4*X[:,0]*X[:,2],4*X[:,0]*(X[:,0] + X[:,1] + 2*X[:,2] - 1)))
				CWij[:,:,14]=column_stack((Z,12 - 12*X[:,1] - 24*X[:,2] - 12*X[:,0],12*X[:,2]))
				Wij[:,:,15]=column_stack((-4*X[:,1]*(X[:,0] + 2*X[:,1] + 2*X[:,2] - 2),4*X[:,0]*(X[:,0] + 2*X[:,1] + X[:,2] - 1),4*X[:,0]*X[:,1]))
				CWij[:,:,15]=column_stack((Z,-12*X[:,1],12*X[:,0] + 24*X[:,1] + 12*X[:,2] - 12))
				Wij[:,:,16]=column_stack((-4*X[:,1]*X[:,2],-4*X[:,0]*X[:,2],8*X[:,0]*X[:,1]))
				CWij[:,:,16]=column_stack((12*X[:,0],-12*X[:,1],Z))
				Wij[:,:,17]=column_stack((4*X[:,1]*X[:,2],4*X[:,2]*(X[:,0] + 2*X[:,1] + X[:,2] - 1),-4*X[:,1]*(2*X[:,0] + 2*X[:,1] + X[:,2] - 2)))
				CWij[:,:,17]=column_stack((12 - 24*X[:,1] - 12*X[:,2] - 12*X[:,0],12*X[:,1],Z))
				Wij[:,:,18]=column_stack((4*X[:,2]*(2*X[:,0] + X[:,1] + X[:,2] - 1),4*X[:,0]*X[:,2],-4*X[:,0]*(2*X[:,0] + 2*X[:,1] + X[:,2] - 2)))
				CWij[:,:,18]=column_stack((-12*X[:,0],24*X[:,0] + 12*X[:,1] + 12*X[:,2] - 12,Z))
				Wij[:,:,19]=column_stack((4*X[:,1]*(2*X[:,0] + X[:,1] + X[:,2] - 1),-4*X[:,0]*(2*X[:,0] + X[:,1] + 2*X[:,2] - 2),4*X[:,0]*X[:,1]))
				CWij[:,:,19]=column_stack((12*X[:,0],Z,12 - 12*X[:,1] - 12*X[:,2] - 24*X[:,0]))


			elif orientation == -1:
				
				Wij[:,:,0]=column_stack((8*X[:,0]*X[:,1] - 12*X[:,1] - 12*X[:,2] - 6*X[:,0] + 8*X[:,0]*X[:,2] + 16*X[:,1]*X[:,2] + 8*X[:,1]**2 + 8*X[:,2]**2 + 4,-2*X[:,0]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),-2*X[:,0]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3)))
				CWij[:,:,0]=column_stack((Z,24*X[:,0] + 24*X[:,1] + 24*X[:,2] - 18,18 - 24*X[:,1] - 24*X[:,2] - 24*X[:,0]))
				Wij[:,:,1]=column_stack((6*X[:,0] + 2*X[:,1] + 2*X[:,2] - 8*X[:,0]*X[:,1] - 8*X[:,0]*X[:,2] - 2,4*X[:,0]*(2*X[:,0] - 1),4*X[:,0]*(2*X[:,0] - 1)))
				CWij[:,:,1]=column_stack((Z,6 - 24*X[:,0],24*X[:,0] - 6))
				Wij[:,:,2]=column_stack((-2*X[:,1]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),8*X[:,0]*X[:,1] - 6*X[:,1] - 12*X[:,2] - 12*X[:,0] + 16*X[:,0]*X[:,2] + 8*X[:,1]*X[:,2] + 8*X[:,0]**2 + 8*X[:,2]**2 + 4,-2*X[:,1]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3)))
				CWij[:,:,2]=column_stack((18 - 24*X[:,1] - 24*X[:,2] - 24*X[:,0],Z,24*X[:,0] + 24*X[:,1] + 24*X[:,2] - 18))
				Wij[:,:,3]=column_stack((4*X[:,1]*(2*X[:,1] - 1),2*X[:,0] + 6*X[:,1] + 2*X[:,2] - 8*X[:,0]*X[:,1] - 8*X[:,1]*X[:,2] - 2,4*X[:,1]*(2*X[:,1] - 1)))
				CWij[:,:,3]=column_stack((24*X[:,1] - 6,Z,6 - 24*X[:,1]))
				Wij[:,:,4]=column_stack((-2*X[:,2]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),-2*X[:,2]*(4*X[:,0] + 4*X[:,1] + 4*X[:,2] - 3),16*X[:,0]*X[:,1] - 12*X[:,1] - 6*X[:,2] - 12*X[:,0] + 8*X[:,0]*X[:,2] + 8*X[:,1]*X[:,2] + 8*X[:,0]**2 + 8*X[:,1]**2 + 4))
				CWij[:,:,4]=column_stack((24*X[:,0] + 24*X[:,1] + 24*X[:,2] - 18,18 - 24*X[:,1] - 24*X[:,2] - 24*X[:,0],Z))
				Wij[:,:,5]=column_stack((4*X[:,2]*(2*X[:,2] - 1),4*X[:,2]*(2*X[:,2] - 1),2*X[:,0] + 2*X[:,1] + 6*X[:,2] - 8*X[:,0]*X[:,2] - 8*X[:,1]*X[:,2] - 2))
				CWij[:,:,5]=column_stack((6 - 24*X[:,2],24*X[:,2] - 6,Z))
				Wij[:,:,6]=column_stack((2*X[:,1]*(4*X[:,0] - 1),-4*X[:,0]*(2*X[:,0] - 1),Z))
				CWij[:,:,6]=column_stack((Z,Z,6 - 24*X[:,0]))
				Wij[:,:,7]=column_stack((4*X[:,1]*(2*X[:,1] - 1),-2*X[:,0]*(4*X[:,1] - 1),Z))
				CWij[:,:,7]=column_stack((Z,Z,6 - 24*X[:,1]))
				Wij[:,:,8]=column_stack((Z,-2*X[:,2]*(4*X[:,1] - 1),4*X[:,1]*(2*X[:,1] - 1)))
				CWij[:,:,8]=column_stack((24*X[:,1] - 6,Z,Z))
				Wij[:,:,9]=column_stack((Z,-4*X[:,2]*(2*X[:,2] - 1),2*X[:,1]*(4*X[:,2] - 1)))
				CWij[:,:,9]=column_stack((24*X[:,2] - 6,Z,Z))
				Wij[:,:,10]=column_stack((-4*X[:,2]*(2*X[:,2] - 1),Z,2*X[:,0]*(4*X[:,2] - 1)))
				CWij[:,:,10]=column_stack((Z,6 - 24*X[:,2],Z))
				Wij[:,:,11]=column_stack((-2*X[:,2]*(4*X[:,0] - 1),Z,4*X[:,0]*(2*X[:,0] - 1)))
				CWij[:,:,11]=column_stack((Z,6 - 24*X[:,0],Z))
				Wij[:,:,12]=column_stack((8*X[:,1]*X[:,2],-4*X[:,0]*X[:,2],-4*X[:,0]*X[:,1]))
				CWij[:,:,12]=column_stack((Z,12*X[:,1],-12*X[:,2]))
				Wij[:,:,13]=column_stack((4*X[:,1]*X[:,2],-4*X[:,2]*(2*X[:,0] + X[:,1] + 2*X[:,2] - 2),4*X[:,1]*(X[:,0] + X[:,1] + 2*X[:,2] - 1)))
				CWij[:,:,13]=column_stack((12*X[:,0] + 12*X[:,1] + 24*X[:,2] - 12,Z,-12*X[:,2]))
				Wij[:,:,14]=column_stack((-4*X[:,2]*(X[:,0] + 2*X[:,1] + 2*X[:,2] - 2),4*X[:,0]*X[:,2],4*X[:,0]*(X[:,0] + X[:,1] + 2*X[:,2] - 1)))
				CWij[:,:,14]=column_stack((Z,12 - 12*X[:,1] - 24*X[:,2] - 12*X[:,0],12*X[:,2]))
				Wij[:,:,15]=column_stack((4*X[:,1]*(2*X[:,0] + X[:,1] + X[:,2] - 1),-4*X[:,0]*(2*X[:,0] + X[:,1] + 2*X[:,2] - 2),4*X[:,0]*X[:,1]))
				CWij[:,:,15]=column_stack((12*X[:,0],Z,12 - 12*X[:,1] - 12*X[:,2] - 24*X[:,0]))
				Wij[:,:,16]=column_stack((-4*X[:,1]*X[:,2],-4*X[:,0]*X[:,2],8*X[:,0]*X[:,1]))
				CWij[:,:,16]=column_stack((12*X[:,0],-12*X[:,1],Z))
				Wij[:,:,17]=column_stack((4*X[:,1]*X[:,2],4*X[:,2]*(X[:,0] + 2*X[:,1] + X[:,2] - 1),-4*X[:,1]*(2*X[:,0] + 2*X[:,1] + X[:,2] - 2)))
				CWij[:,:,17]=column_stack((12 - 24*X[:,1] - 12*X[:,2] - 12*X[:,0],12*X[:,1],Z))
				Wij[:,:,18]=column_stack((4*X[:,2]*(2*X[:,0] + X[:,1] + X[:,2] - 1),4*X[:,0]*X[:,2],-4*X[:,0]*(2*X[:,0] + 2*X[:,1] + X[:,2] - 2)))
				CWij[:,:,18]=column_stack((-12*X[:,0],24*X[:,0] + 12*X[:,1] + 12*X[:,2] - 12,Z))
				Wij[:,:,19]=column_stack((-4*X[:,1]*(X[:,0] + 2*X[:,1] + 2*X[:,2] - 2),4*X[:,0]*(X[:,0] + 2*X[:,1] + X[:,2] - 1),4*X[:,0]*X[:,1]))
				CWij[:,:,19]=column_stack((Z,-12*X[:,1],12*X[:,0] + 24*X[:,1] + 12*X[:,2] - 12))


			return (Wij,CWij,Nq)